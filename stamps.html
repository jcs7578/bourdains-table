<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Passport Stamps â€” Eat Like Anthony</title>
  <meta name="description" content="Every country Anthony Bourdain visited, displayed as passport stamps. Click to mark countries you've been to.">

  <!-- App CSS -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

  <!-- ============ NAV ============ -->
  <nav class="site-nav">
    <a href="index.html" class="nav-link">Map</a>
    <a href="stamps.html" class="nav-link active">Passport</a>
    <a href="dishes.html" class="nav-link">Dishes</a>
    <a href="about.html" class="nav-link">About</a>
  </nav>

  <!-- ============ HEADER ============ -->
  <header class="site-header">
    <h1 class="site-title">Your Passport</h1>
    <p class="site-subtitle">"Walk in someone else's shoes â€” or at least eat their food."</p>
    <div class="stamps-stats">
      <span class="stat-item" id="stat-countries"></span>
      <span class="stat-divider">/</span>
      <span class="stat-item" id="stat-restaurants"></span>
      <span class="stat-divider">/</span>
      <span class="stat-item" id="stat-shows"></span>
    </div>
  </header>

  <!-- ============ MAIN ============ -->
  <main class="stamps-content">

    <!-- Personal passport controls -->
    <div class="passport-controls">
      <span class="passport-progress" id="passport-progress">
        0 of 47 stamped
        <span class="passport-progress-bar">
          <span class="passport-progress-fill" id="progress-fill" style="width: 0%"></span>
        </span>
      </span>
      <button class="btn-clear-passport" id="btn-clear">Clear All</button>
    </div>
    <p style="text-align:center; font-family: var(--font-mono); font-size: 0.7rem; color: var(--ink-light); margin-bottom: 1rem; opacity: 0.7;">
      Click a stamp to mark countries you've visited
    </p>

    <div class="passport-book">
      <div class="passport-page-header">
        <span class="passport-page-label">VISAS &amp; ENTRY STAMPS</span>
        <span class="passport-page-label">VISAS ET CACHETS D'ENTR&Eacute;E</span>
      </div>
      <div id="stamps-grid" class="stamps-grid">
        <!-- Rendered by JS -->
      </div>
    </div>
  </main>

  <!-- ============ FOOTER ============ -->
  <footer class="site-footer">
    <p class="footer-quote">"Without experimentation, a willingness to ask questions and try new things, we shall surely become static, repetitive, and moribund."</p>
    <p>Built with Leaflet.js &middot; No frameworks, no fuss.</p>
  </footer>

  <!-- Data (needed for stamp generation) -->
  <script src="js/data.js"></script>
  <script>
    (function () {
      'use strict';

      // ---- localStorage for visited countries ----
      var STORAGE_KEY = 'eatlikeanthony_visited';

      function getVisited() {
        try {
          var raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch (e) {
          return [];
        }
      }

      function saveVisited(arr) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
        } catch (e) { /* silently fail */ }
      }

      function toggleVisited(country) {
        var visited = getVisited();
        var idx = visited.indexOf(country);
        if (idx === -1) {
          visited.push(country);
        } else {
          visited.splice(idx, 1);
        }
        saveVisited(visited);
        return visited;
      }

      // Country stamp ink colors â€” muted/faded to look like real passport ink
      var COUNTRY_STAMPS = {
        "Argentina":           { ink: '#4a7a9e', icon: 'ðŸ‡¦ðŸ‡·' },
        "Australia":           { ink: '#1a3a6b', icon: 'ðŸ‡¦ðŸ‡º' },
        "Brazil":              { ink: '#2a7a3b', icon: 'ðŸ‡§ðŸ‡·' },
        "Cambodia":            { ink: '#6b2d4a', icon: 'ðŸ‡°ðŸ‡­' },
        "Canada":              { ink: '#8b2a2a', icon: 'ðŸ‡¨ðŸ‡¦' },
        "China":               { ink: '#a0342a', icon: 'ðŸ‡¨ðŸ‡³' },
        "Colombia":            { ink: '#8a6b1a', icon: 'ðŸ‡¨ðŸ‡´' },
        "Cuba":                { ink: '#2a4a7b', icon: 'ðŸ‡¨ðŸ‡º' },
        "Denmark":             { ink: '#943040', icon: 'ðŸ‡©ðŸ‡°' },
        "Ethiopia":            { ink: '#2a6b3a', icon: 'ðŸ‡ªðŸ‡¹' },
        "France":              { ink: '#1a2a6b', icon: 'ðŸ‡«ðŸ‡·' },
        "Georgia":             { ink: '#8b3a3a', icon: 'ðŸ‡¬ðŸ‡ª' },
        "Greece":              { ink: '#2a4a8b', icon: 'ðŸ‡¬ðŸ‡·' },
        "Hong Kong":           { ink: '#a0342a', icon: 'ðŸ‡­ðŸ‡°' },
        "India":               { ink: '#b06a1a', icon: 'ðŸ‡®ðŸ‡³' },
        "Indonesia":           { ink: '#8b2a2a', icon: 'ðŸ‡®ðŸ‡©' },
        "Iran":                { ink: '#2a6b4a', icon: 'ðŸ‡®ðŸ‡·' },
        "Israel":              { ink: '#1a3a7b', icon: 'ðŸ‡®ðŸ‡±' },
        "Italy":               { ink: '#2a6b3a', icon: 'ðŸ‡®ðŸ‡¹' },
        "Jamaica":             { ink: '#3a6b2a', icon: 'ðŸ‡¯ðŸ‡²' },
        "Japan":               { ink: '#a03030', icon: 'ðŸ‡¯ðŸ‡µ' },
        "Kenya":               { ink: '#3a5a2a', icon: 'ðŸ‡°ðŸ‡ª' },
        "Laos":                { ink: '#2a3a6b', icon: 'ðŸ‡±ðŸ‡¦' },
        "Lebanon":             { ink: '#8b3040', icon: 'ðŸ‡±ðŸ‡§' },
        "Madagascar":          { ink: '#2a5a3a', icon: 'ðŸ‡²ðŸ‡¬' },
        "Malaysia":            { ink: '#1a2a5b', icon: 'ðŸ‡²ðŸ‡¾' },
        "Mexico":              { ink: '#3a5a3a', icon: 'ðŸ‡²ðŸ‡½' },
        "Morocco":             { ink: '#8b3030', icon: 'ðŸ‡²ðŸ‡¦' },
        "Myanmar":             { ink: '#8a7a1a', icon: 'ðŸ‡²ðŸ‡²' },
        "Nigeria":             { ink: '#2a6b3a', icon: 'ðŸ‡³ðŸ‡¬' },
        "Peru":                { ink: '#943030', icon: 'ðŸ‡µðŸ‡ª' },
        "Philippines":         { ink: '#2a4a8b', icon: 'ðŸ‡µðŸ‡­' },
        "Portugal":            { ink: '#2a5a2a', icon: 'ðŸ‡µðŸ‡¹' },
        "Puerto Rico":         { ink: '#3a3a6b', icon: 'ðŸ‡µðŸ‡·' },
        "Senegal":             { ink: '#2a6b3a', icon: 'ðŸ‡¸ðŸ‡³' },
        "Singapore":           { ink: '#8b3040', icon: 'ðŸ‡¸ðŸ‡¬' },
        "South Korea":         { ink: '#1a3a6b', icon: 'ðŸ‡°ðŸ‡·' },
        "Spain":               { ink: '#8b2a1a', icon: 'ðŸ‡ªðŸ‡¸' },
        "Tanzania":            { ink: '#2a6b4a', icon: 'ðŸ‡¹ðŸ‡¿' },
        "Thailand":            { ink: '#6b2a3a', icon: 'ðŸ‡¹ðŸ‡­' },
        "Trinidad and Tobago": { ink: '#8b3030', icon: 'ðŸ‡¹ðŸ‡¹' },
        "Turkey":              { ink: '#a03020', icon: 'ðŸ‡¹ðŸ‡·' },
        "Uganda":              { ink: '#3a3a2a', icon: 'ðŸ‡ºðŸ‡¬' },
        "United Kingdom":      { ink: '#1a2a5b', icon: 'ðŸ‡¬ðŸ‡§' },
        "United States":       { ink: '#2a3a6b', icon: 'ðŸ‡ºðŸ‡¸' },
        "Uruguay":             { ink: '#1a2a7b', icon: 'ðŸ‡ºðŸ‡¾' },
        "Vietnam":             { ink: '#943020', icon: 'ðŸ‡»ðŸ‡³' },
      };

      var DEFAULT_STAMP = { ink: '#5a4d3e', icon: '' };

      // Gather country data from restaurants
      var countryData = {};
      RESTAURANTS.forEach(function (r) {
        var c = r.country;
        if (!countryData[c]) {
          countryData[c] = { shows: new Set(), count: 0, cities: new Set() };
        }
        countryData[c].count++;
        countryData[c].shows.add(r.show);
        countryData[c].cities.add(r.city);
      });

      // Sort countries by restaurant count (descending)
      var countries = Object.keys(countryData).sort(function (a, b) {
        return countryData[b].count - countryData[a].count;
      });

      // Random rotation between -5 and 5 degrees
      function randRotation() {
        return (Math.random() * 10 - 5).toFixed(1);
      }

      // Random opacity variation (0.45 - 0.65) for unvisited worn ink
      function randOpacity() {
        return (0.45 + Math.random() * 0.2).toFixed(2);
      }

      var shapes = ['stamp-circle', 'stamp-rect', 'stamp-rounded'];

      // Render stamps
      var grid = document.getElementById('stamps-grid');
      var html = '';
      var visited = getVisited();

      countries.forEach(function (country, idx) {
        var data = countryData[country];
        var stamp = COUNTRY_STAMPS[country] || DEFAULT_STAMP;
        var shape = shapes[idx % shapes.length];
        var rotation = randRotation();
        var opacity = randOpacity();
        var isVisited = visited.indexOf(country) !== -1;
        var cities = Array.from(data.cities).slice(0, 3).join(' \u2022 ');
        var showList = Array.from(data.shows).map(function (s) {
          return SHOW_MAP[s] ? SHOW_MAP[s].abbr : s;
        }).join(' / ');

        html += '<div class="passport-stamp ' + shape + (isVisited ? ' visited' : '') + '"';
        html += ' data-country="' + country + '"';
        html += ' data-base-opacity="' + opacity + '"';
        html += ' style="';
        html += 'transform: rotate(' + rotation + 'deg);';
        html += '--stamp-ink: ' + stamp.ink + ';';
        if (!isVisited) html += 'opacity: ' + opacity + ';';
        html += '">';
        html += '<span class="stamp-check">&#10003;</span>';
        html += '<div class="stamp-icon">' + stamp.icon + '</div>';
        html += '<div class="stamp-country">' + country.toUpperCase() + '</div>';
        html += '<div class="stamp-count">' + data.count + ' spot' + (data.count > 1 ? 's' : '') + '</div>';
        html += '<div class="stamp-cities">' + cities + '</div>';
        html += '<div class="stamp-shows">' + showList + '</div>';
        html += '</div>';
      });

      grid.innerHTML = html;

      // ---- Progress bar ----
      var progressEl = document.getElementById('passport-progress');
      var progressFill = document.getElementById('progress-fill');

      function updateProgress() {
        var v = getVisited();
        var count = v.length;
        var total = countries.length;
        var pct = total > 0 ? Math.round((count / total) * 100) : 0;
        progressEl.innerHTML = count + ' of ' + total + ' stamped (' + pct + '%)' +
          ' <span class="passport-progress-bar"><span class="passport-progress-fill" id="progress-fill" style="width:' + pct + '%"></span></span>';
      }

      updateProgress();

      // ---- Click handlers on stamps ----
      var stamps = grid.querySelectorAll('.passport-stamp');
      stamps.forEach(function (el) {
        el.addEventListener('click', function () {
          var country = this.getAttribute('data-country');
          var visited = toggleVisited(country);
          var isNowVisited = visited.indexOf(country) !== -1;

          if (isNowVisited) {
            this.classList.add('visited');
            this.style.opacity = '';
          } else {
            this.classList.remove('visited');
            this.style.opacity = this.getAttribute('data-base-opacity');
          }

          updateProgress();
        });
      });

      // ---- Clear all button ----
      document.getElementById('btn-clear').addEventListener('click', function () {
        saveVisited([]);
        stamps.forEach(function (el) {
          el.classList.remove('visited');
          el.style.opacity = el.getAttribute('data-base-opacity');
        });
        updateProgress();
      });

      // Stats
      document.getElementById('stat-countries').textContent = countries.length + ' Countries';
      document.getElementById('stat-restaurants').textContent = RESTAURANTS.length + ' Restaurants';
      document.getElementById('stat-shows').textContent = '4 Shows';
    })();
  </script>

</body>
</html>
